on first join:
    set {kills::%player%} to 0
    set {deaths::%player%} to 0
    #
    random(player)

on respawn:
    random(player)

on death of player:
    clear drops
    add 1 to {deaths::%player%}
    if attacker is player:
        add 1 to {kills::%player%}
    chance of 30%:
        set {_arm::*} to chestplate, leggings, boots
        set {_arm} to random element out of {_arm::*}
        add victim's {_arm} to drops

on pickup of chainmail chestplate, chainmail leggings, chainmail boots, iron chestplate, iron leggings, iron boots, diamond chestplate, diamond leggings, diamond boots:
    set {_p} to player
    set {_item} to event-item
    set {_type} to type of {_item}
    # Determine slot
    if {_type} = chestplate:
        set {_slot} to "chestplate"
    else if {_type} = leggings:
        set {_slot} to "leggings"
    else if {_type} = boots:
        set {_slot} to "boots"
    else:
        stop
    # chain = 3/2/1, iron = 4/3/2, diamond = 6/4/3
    set {_new} to 0
    set {_old} to 0

    if {_type} is chainmail boots: set {_new} to 1
    else if {_type} is chainmail chestplate: set {_new} to 3
    else if {_type} is chainmail leggings: set {_new} to 2
    else if {_type} is iron boots: set {_new} to 2
    else if {_type} is iron chestplate: set {_new} to 4
    else if {_type} is iron leggings: set {_new} to 3
    else if {_type} is diamond boots: set {_new} to 3
    else if {_type} is diamond chestplate: set {_new} to 6
    else if {_type} is diamond leggings: set {_new} to 4

    set {_cur} to {_p}'s {_slot}
    if {_cur} is chainmail boots: set {_old} to 1
    else if {_cur} is chainmail chestplate: set {_old} to 3
    else if {_cur} is chainmail leggings: set {_old} to 2
    else if {_cur} is iron boots: set {_old} to 2
    else if {_cur} is iron chestplate: set {_old} to 4
    else if {_cur} is iron leggings: set {_old} to 3
    else if {_cur} is diamond boots: set {_old} to 3
    else if {_cur} is diamond chestplate: set {_old} to 6
    else if {_cur} is diamond leggings: set {_old} to 4

    if {_new} > {_old}:
        if {_cur} is not air:
            drop {_cur} at location of {_p}
        set {_p}'s {_slot} to {_item}
        cancel event

function random(p: player):
    set {_arm::*} to chestplate, leggings, boots
    set {_arm} to random element out of {_arm::*}
    set {_p}'s chestplate to chainmail chestplate
    set {_p}'s leggings to chainmail leggings
    set {_p}'s boots to chainmail boots
    set {_p}'s {_arm} to iron {_arm}
    give {_p} iron sword
    give {_p} bow
    set {_p}'s offhand to 8 arrow

function playtime(p: player):
    set {_total} to {playtime::%{_p}%}
    set {_s} to {_total} mod 60
    if {_s} < 10:
        set {_s} to "%0{_s}%"
    set {_m} to floor({_total} / 60) mod 60
    if {_m} < 10:
        set {_m} to "%0{_s}%"
    set {_h} to floor({_total} / 3600)
    if {_h} < 10:
        set {_h} to "%0{_s}%"
    return "%{_h}%:%{_m}%:%{_s}%"
